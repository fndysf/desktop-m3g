\subsection{カメラ}

Cameraクラスはカメラを表すシーンノードの構成要素の１つです。
カメラはインスタンス化してWorldオブジェクトに追加したあと、
アクティブ化すると有効になります。
アクティブ化できるカメラは同時に1つだけです。

\begin{verbatim}
Camera* cam = new Camera;
wld->addChild (cam);
wld->setActiveCamera (cam);
\end{verbatim}


\subsubsection{カメラの種類}
カメラは透視投影と平行投影か、もしくは任意の4x4の変換行列を指定できます。
デフォルトは平行投影で、原点(0,0,0)に位置しZ軸負の方向を向いています。

\subsubsection{平行投影}

カメラを平行投影にするにはsetParallel()メソッドを使います。

\begin{verbatim}
void 	setParallel (float height, float aspect_ratio, float near, float far)
\end{verbatim}

引数で指定するパラメーターはOpenGLと同じです。
第1引数には縦方向の視野領域(top-bottom)を、第2引数には
アスペクト比(width/height)、第3引数と第4引数で
nearクリッピング面とfarクリッピング面を指定します。

現在のこれらのパラメーターはgetProjectionメソッドで取得できます。

\begin{verbatim}
int 	getProjection (float *params) const
\end{verbatim}

引数のparamsには最低float4つが書き込める領域を指定します。
順番にheight, aspect\_ratio, near, farが書き込まれれます。

\subsubsection{透視投影}

カメラを透視投影にするにはstePerspective()メソッドを使います。

\begin{verbatim}
void 	setPerspective (float fovy, float aspect_ratio, float near, float far)
\end{verbatim}

引数で指定するパラメーターはOpenGLと同じです。
第1引数は縦方向のfovを角度(degree)で、第2引数は
アスペクト比(width/height)、第3引数と第4引数で
nearクリッピング面とfarクリッピング面を指定します。


現在のパラメーターはgetProjectionメソッドで取得できます。
\begin{verbatim}
int 	getProjection (float *params) const
\end{verbatim}

引数のparamsには最低float4つが書き込める領域を指定します。
順番にfovy, aspect\_ratio, near, farが書き込まれれます。


\subsubsection{任意の射影変換}
平行投影、透視投影以外にも任意の4x4行列を指定して射影変換を行う事ができます。
変換行列はTransformオブジェクトを作成して渡します。
ここで指定する行列はOpenGLのPROJECTION行列に相当します。

\begin{verbatim}
void 	setGeneric (const Transform &transorm)
\end{verbatim}

引数には適切に設定したTransform行列を渡します。
射影行列は逆行列が計算できる必要があります。
行列は内部でコピーして保存されます。
従ってメソッド呼び出し後の変更は反映されません。

現在のパラメーターはgetProjectionメソッドで取得できます。

\begin{verbatim}
    int getProjection (Transform* transform) const;
\end{verbatim}

引数には結果を受け取るTransformオブジェクトのポインターを指定します。


\subsubsection{カメラの位置、方向}
カメラの位置と視線方向の変更はCameraクラスの基底クラスである
Transformableクラスを使ってアフィン変換を指定して行います。
デフォルトでは位置は原点(0,0,0)で視線方向はZ軸負の向き(0,0,-1)で
upベクトルはY軸正の向き(0,1,0)です。
例えばここから位置をZ軸上の点(0,0,10)に移動するにはこのようにします。

\begin{verbatim}
  Camera* cam = new Camera;
  cam->translate (0,0,10);
\end{verbatim}

通常のアフィン変換（回転、平行移動）を駆使して任意の方向にカメラを設定するのは
かなり手間がかかります。
Desktop-M3GではM3G非標準ですがglutのglLookAt()関数に相当するlookAt()メソッドを実装しています。

\subsubsection{lookAt関数}
カメラ位置（from\_x, from\_y, from\_z), 視線上の1点(to\_x, to\_y, to\_z)、upベクトル(up\_x, up\_y, up\_z)を指定して
カメラの位置、向きをわかりやすく設定します。
glutのgluLookAt()関数に相当します。
upベクトルは正規化されている必要はありません。

\begin{verbatim}
void 	lookAt (float from_x, float from_y, float from_z, float to_x, float to_y, float to_z, float up_x, float up_y, float up_z)
\end{verbatim}


