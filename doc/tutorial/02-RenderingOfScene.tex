
\subsection{描画の基本}
この章では実際にM3G APIを使ったシーンの描画を解説します。

\subsubsection{immediateモードとretainedモード}
M3Gには1行1行レンダリングコマンドを実行するimmediateモードと、
シーングラフを作成し一括してレンダリングするretainedモードがあります。
現在のDesktop-M3Gの実装ではretainedモードのみ対応しています。

\subsubsection{シーンとシーンの描画}
シーンはWorldクラスのオブジェクトを頂点とする木構造です。
描画はGraphics3Dクラスが行います。
従ってM3Gでの基本的な描画手順は、
\begin{itemize}
 \item Worldを頂点とするシーングラフの作成
 \item Graphics3Dに渡して描画
\end{itemize}
になります。コードではこのようになります。

\begin{quotation}
\begin{verbatim}
World* wld = new World;
Graphics3D* g3d = Graphics3D::getInstance();
g3d->render (wld);
\end{verbatim}
\end{quotation}

Graphics3Dクラスはnew演算子でインスタンス化せずに専用のgetInstance()メソッドでインスタンス化します。
シングルトン化されており常に同じオブジェクトが返ります。
上記は完全に正しいコードですがこれだけでは何も表示されません。
何か物体を表示するためにはシーンに(1)カメラおよび(2)メッシュを追加する必要があります。

\subsection{カメラ}
シーンにカメラオブジェクトを追加しアクティブにします。
シーンには複数のカメラを設置できますが、同時にアクティブにできるのは1つだけです。

\begin{quotation}
\begin{verbatim}
  Camera* cam = new Camera;
  wld->addChild (cam);
  wld->setActiveCamera (cam);
\end{verbatim}
\end{quotation}

デフォルトのカメラは平行投影でz軸負の方向を向いています。
これを透視投影に変えるにはsetPerspective()メソッドを使います。

\begin{quotation}
\begin{verbatim}
  Camera* cam = wld->getActiveCamera();
  cam->setPerspective (45, h/w, 0.1, 100);
\end{verbatim}
\end{quotation}

現在アクティブなカメラはgetActiveCamera()メソッドで取得できます。
setPerspective()の引数はOpenGLのglPerspectiveと同じ、fov、アスペクト比、near, farです。
詳しくはM3Gのリファレンスマニュアルをご覧ください。


\subsection{メッシュ}
M3Gのプリミティブはメッシュのみです。トライアングル1個もメッシュとして描画します。
あらゆる高次サーフェス（NURBS、Bezierパッチなど）およびパーティクルはありません。
メッシュはデータを保持するVertexArrayクラスと頂点としてデータを保持する
VertexBufferクラス、インデックスを保持するTriangleStripクラスからなります。
またマテリアルなどを保持するAppearanceクラスも同時に渡します。


VertexArray,VertexBuffer,TriangleStrip,Meshに関しては
次章以降のチュートリアルをご覧ください。


\subsection{最小限のシーンの描画}

この章では４角形を表示する最小限のシーンを描画します。
使用するM3GのクラスはWorld,Camera,Meshほかです。
ここではglutを使った完全なコードを示します。

現在コードは省略されています。


\subsection{シーンの構成要素}

シーンを構成する要素はすべてNodeクラスを派生しています。
以下のクラスは全てNodeを基底クラスに持ちWorldクラスに挿入可能です。

Camera, Group, Light, Mesh, MorphingMesh, SkinnedMesh, Sprite3D

なおこのほかにWorldクラスもNodeを派生しますが、WorldクラスにWorldクラスを挿入する事はできません。



