\subsection{キーフレームシーケンス}

アニメーションはキーフレームと呼ばれる、ある時刻に対するデータを
連続して補完する事で実現されます。
キーフレームの集合をキームレームシーケンスと呼びKeyframeSequenceクラスで扱います。
キーフレームは整数値の時刻tと浮動小数点のデータからなります。
キーフレームシーケンスは複数のキーフレームを持ち、
任意時刻tに対するデータの補間方法や、時刻の有効期間も定義します。

キーフレームは単なるデータの集合であり、
データをどのように解釈するかはAnimationTrackクラスが行います。

キーフレームシーケンスの基本的な構築方法は、

\begin{itemize}
\item キーフレーム数を指定してキーフレームシーケンスの作成
\item 有効範囲(valid range)の設定
\item 継続期間(duration)の設定
\end{itemize}


キーフレームシーケンスはキーフレーム数と１フレーム当たりのコンポーネント数、
キーフレーム間の補間方法を指定してインスタンス化します。

\begin{verbatim}
 	KeyframeSequence (int numKeyframes, int numComponents, int interpolation)
\end{verbatim}

第１引数のnum\_keyframesにはキーフレームの数を、第２引数のnum\_componentsには
キーフレームの保持するコンポーネント数を、第３引数のinterpolationには
補間方法をSTEP, LINEAR, SPLINE, SLERP, SQUADの中から指定します。
それぞれSTEPがステップ補間、線形補間、スプライン補間、
クォータニオンのスプライン補間、クオータニオンの球面線形補間を表します。

設定されたキーフレーム数はgetkeyframeCount()メソッドで取得します。

\begin{verbatim}
int 	getKeyframeCount () const
\end{verbatim}

設定されたのコンポーネント数はgetComponentCount()メソッドで取得します。

\begin{verbatim}
int 	getComponentCount () const
\end{verbatim}

設定された補間方法はgetInterpolationType()メソッドで取得します。

\begin{verbatim}
int 	getInterpolationType () const
\end{verbatim}


\subsubsection{補間方法}
補間方法はSTEP, LINEAR, SPLINE, SLERP, SQUADの中から選択します。

ここに表
\begin{tabular}{ll}
  STEP   &  ステップ補間   & $ v = v_i $ \\
  LINEAR &  線形補間       & $ v = (1-s)V_i + sV_{i+1} $ \\
  SPLINE &  スプライン補間 & 略（M3Gの仕様書を参照してください) \\
  SLERP  &  クォータニオンの球面線形補間 & 略（M3Gの仕様書を参照してください) \\
  SQUAD  &  クォータニオンのスプライン補間 & 略（M3Gの仕様書を参照してください) 
\end{tabular}


\subsubsection{キーフレームの設定}

コンストラクタで指定したキーフレームの数だけ
キーフレーム毎にsetKeyframe()メソッドを呼び出してデータを設定します。


\begin{verbatim}
void 	setKeyframe (int index, int time, float *value)
\end{verbatim}

引数のindexは0から始まるキーフレーム番号です。
存在しないフレーム番号を指定するとエラーになります。
引数timeには時刻を0以上の整数値で指定し、
引数valueにはデータへのポインターを渡します。
データはM3Gライブラリ内部にコピーされます。
セットされたキーフレームはsetValidRange()で有効化される必要があります。

\subsubsection{有効範囲の設定}

セットされたキーフレームのうち有効なフレームをsetValidRange()メソッドで指定します。
単にsetKeyframeでセットしただけでは有効になりません。

\begin{verbatim}
void 	setValidRange (int first, int last)
\end{verbatim}

引数のfirstとlastは0から始まるフレーム番号を指定します。上限はgetKyframeCount()-1です。
firstとlastは有効なフレームに含みます。
存在しないフレーム番号を指定するとエラーになります。

現在の有効範囲はgetValidRangeFirst()メソッド、getValidRangleLast()メソッドで取得できます。

\begin{verbatim}
int 	getValidRangeFirst () const
int 	getValidRangeLast () const
\end{verbatim}

\subsubsection{継続時間の設定}

このキーフレームシーケンスの継続時間をsetDuration()メソッドで指定します。
継続時間とはこのキーフレームシーケンスが再生される長さ（時間）です。

\begin{verbatim}
void 	setDuration (int duration)
\end{verbatim}

引数のdurationには0より大きな整数値を指定します。
デフォルトは0です。

現在の継続時間はgetDuration()メソッドで取得できます。

\begin{verbatim}
int 	getDuration () const
\end{verbatim}


\subsubsection{繰り返しモード}

このキーフレームシーケンスの繰り返しモードをsetRepeatMode()で指定します。
繰り返しは継続時間を超える時刻のアニメーションの再生方法に関係します。

\begin{verbatim}
void 	setRepeatMode (int mode)
\end{verbatim}

引数のmodeはCONSTANT, LOOPから選択します。
LOOPは継続時間のアニメーションを繰り返します。
CONSTANTは繰り返し無しで継続時間を超える時刻には最後のフレームが使われます。

現在の繰り返しモードはgetRepeatMode()メソッドで取得できます。

\begin{verbatim}
int 	getRepeatMode () const
\end{verbatim}

