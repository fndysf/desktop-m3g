
\subsection{トランスフォーム可能なオブジェクト}

シーンの構成要素のうちアフィン変換可能なものは
Transformableクラスを基底クラスに持ちます。
具体的にはNodeクラスとTexture2Dクラスの２つが該当します。

\subsubsection{基本的な概念}

M3Gではトランスフォーメーションは４つの要素（平行移動、回転、拡大縮小、汎用4x4行列）を独立に保持・管理し、最後に掛け合わせます。
掛け合わせる順番は、１：汎用4x4行列(M)、２：拡大縮小(S)、３：回転(R)、４：平行移動(T)の順番です。

\[ p' = TRSM p \]

変換を指定するときもこの４つを別々に指定します。

\subsubsection{平行移動}

平行移動はtranslate()メソッドで指定します。

\begin{verbatim}
    void translate (float tx, float ty, float tz);
\end{verbatim}

引数には移動ベクトル(tx,ty,tz)を指定します。
translate()メソッドは現在のTに指定した移動ベクトルを足します。

setTransform()メソッドは現在のTを破棄し指定した移動ベクトルで置き換えます。


\begin{verbatim}
    void setTranslation (float tx, float ty, float tz);
\end{verbatim}

引数にはTransformオブジェクトを指定します。


現在の平行移動(T)を取得するにはgetTranslation()メソッドを使います。

\begin{verbatim}
    void getTranslation (float* xyz) const;
\end{verbatim}

引数には結果を書き込むfloat3つ分の領域を指すポインターを渡します。

\subsection{回転}

回転はpostRotate()メソッドまたはpreRotate()メソッドで行います。
preRotate()メソッドは回転要素に指定された回転を左から乗算します。
postRoate()メソッドは回転要素に指定された回転を右から乗算します。


\begin{verbatim}
    void preRotate (float angle, float ax, float ay, float az);
    void postRotate (float angle, float ax, float ay, float az);
\end{verbatim}

第1引数のangleには回転角度をdereeで指定します。第2，3，4引数で回転軸(ax,ay,az)を指定します。
回転軸は単位ユニットである必要はありません。

setOrientation()メソッドは現在の回転(R)を破棄し指定した回転で置き換えます。

\begin{verbatim}
    void setOrientation (float angle, float ax, float ay, float az);
\end{verbatim}

引数は同様に角度と回転軸を指定します。

\begin{verbatim}
    void getOrientation (float* angle_aixs) const;
\end{verbatim}

\subsubsection{拡大縮小}

拡大縮小はscale()メソッドを使います。

\begin{verbatim}
    void scale (float sx, float sy, float sz);
\end{verbatim}

引数にはX方向、Y方向、Z方向の拡大縮小率を指定します。1.0が現状維持です。

setScale()メソッドは現在のSを破棄し指定した拡大縮小率で置き換えます。

\begin{verbatim}
    void setScale (float sx, float sy, float sz);
\end{verbatim}

引数には同様にX,Y,Z方向の拡大縮小率を指定します。

現在の拡大縮小(S)を取得するにははgetScale()メソッドを使います。

\begin{verbatim}
    void getScale (float* xyz) const;
\end{verbatim}

引数には結果を書き込むfloat3つ分の領域を指すポインターを渡します。


\subsubsection{汎用4x4行列}

M3Gではトランスフォームを表すのに平行移動、回転、拡大縮小の他に、任意の4x4行列(M)を保持します。
これはアフィン変換では行えない変換を指定するのに使います。

\begin{verbatim}
    void setTransform (const Transform& transform);
\end{verbatim}

引数には適切な4x4行列を設定したTransformオブジェクトを渡します。

現在の4x4行列(M)を取得するにはgetTransform()メソッドを使います。

\begin{verbatim}
    void getTransform (Transform* transform) const;
\end{verbatim}

引数には結果を書き込むTransformオブジェクトを渡します。



