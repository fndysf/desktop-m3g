\subsection{ライト}
Lightクラスはライトを表すシーンノードです。
インスタンス化した後にWorldクラスにaddChild()メソッドで追加します。
ライトには環境光(AMBIENT),点光源(OMNI),平行光源(DIRECTIONAL),スポットライト(SPOT)の4種類があります。
ライトにはカラーと強度が設定できます。

\begin{quotation}
\begin{verbatim}
Light* lig = new Light;
wld->addChild (lig);
\end{verbatim}
\end{quotation}

デフォルトは平行光源でZ軸負の方向を向いています。カラーは白色(1,1,1)で強度は1.0です。

\subsubsection{共通設定}
ライトの種類はsetMode()メソッドで変更します。

\begin{quotation}
\begin{verbatim}
void 	setMode (int mode);
\end{verbatim}
\end{quotation}

modeには環境光(AMBIENT),点光源(OMNI),平行光源(DIRECTIONAL),スポットライト(SPOT)の
いずれかを指定します。

現在のライトの種類はgetMode()メソッドで取得できます。

\begin{quotation}
\begin{verbatim}
int 	getMode () const 
\end{verbatim}
\end{quotation}

ライトの色はsetColor()メソッドで指定し、強度はsetIntensity()メソッドで設定します。
色と強度の積が最終的なライトの出力になります。

\begin{quotation}
\begin{verbatim}
void 	setColor (int rgb)
void 	setIntensity (float intensity)
\end{verbatim}
\end{quotation}

引数のrgbにはr(0-255),g(0-255),b(0-255)をrgbフォーマットで整数型にパックして渡します。
intensityは強度を任意の浮動小数値で指定します。0および負の値も指定可能です。

\begin{quotation}
\begin{verbatim}
rgb = (r<<16) || (g<<8) || (b<<0);
\end{verbatim}
\end{quotation}

現在の色の取得にはgetColor()メソッドを、強度の取得にはgetIntensity()メソッドを使います。

\begin{quotation}
\begin{verbatim}
int 	getColor () const
float 	getIntensity () const 
\end{verbatim}
\end{quotation}

ここまでは全てのライトに共通です。

\subsubsection{環境光}
シーン全体を環境光の色で照らします。
設定できる項目は共通設定の項のみです。

\subsubsection{平行光源}
シーンを無限遠方から平行に照らします。光は減衰しません。
デフォルトでZ軸負の方向を向いているので、これにアフィン変換を施して望みの方向に向けます。
例えばY軸負の方向を向いた平行光源を作成する場合はこうなります。

\begin{quotation}
\begin{verbatim}
Light* lig = new Light;
lig->setMode (Light::DIRECTIONAL);
lig->postRotate (-90, 1,0,0);
\end{verbatim}
\end{quotation}

\subsubsection{点光源}
シーンをある１点から照らします。距離によって減衰します。
デフォルトでは原点に位置するのでアフィン変換を施して望みの位置に動かします。
例えばY軸(0,10,0)の位置に動かすにはこのようになります。

\begin{verbatim}
Light* lig = new Light;
lig->setMode (Light::OMNI};
lig->tranlate (0,10,0);
\end{verbatim}

点光源の距離による減衰はsetAttenuation()メソッドを使って制御できます。


\begin{verbatim}
    void setAttenuation (float constant, float linear, float quadratic);
\end{verbatim}


減衰係数αは引数のconstant(c), linear(l), quadratic(q)を使って以下の式で計算されます。

\[ \alpha = \frac{c + l \cdot r + q \cdot r^2}{2} \]

定数項cおよび距離rに比例するr、距離rの2乗に比例するqを設定します。
例えば物理的に正しい距離の2乗に反比例する点光源はsetAttenuation()に
constant=0, linear=0, quadratic=1を指定します。

デフォルトはOpenGLと同じくconstant=1, linear=0, quadratic=0で、
距離による減衰はなく一定の強さで照らされます。

現在の減衰項はgetConstantAttenuation()メソッド、getLinearAttenuation()メソッド、
getQuadraticAttenuation()メソッドで取得できます。

\begin{verbatim}
float 	getConstantAttenuation () const
float 	getLinearAttenuation () const
float 	getQuadraticAttenuation () const 
\end{verbatim}

\subsubsection{スポットライト}
シーンをスポットライトで照らします。距離によって減衰します。
スポットライトの位置と方向は点光源や平行光源と同じようにアフィン変換で制御します。
スポット角度はsetSpotAngle()メソッドで変更し、スポット指数はsetSpotExponent()
メソッドで変更します。

\begin{verbatim}
void 	setSpotAngle (float angle)
void 	setSpotExponent (float exponent)
\end{verbatim}

引数のangleは中心線からライトの照らす一番外側までの
カットオフ角度を0〜90°の間で指定します。デフォルトはangle=45°です。
exponentは中心から外周部に向けての減衰指数を0〜128の範囲で指定します。
デフォルトはexponent=0.0で減衰はなく一様に照らされます。

スポットライト効果(β)は中心線からの角度とexponent(e)を使って以下の式で計算されます。

\[ \beta = (\cos \theta)^e \]

カットオフ角度より大きな角度の領域は0です。

現在の設定値はgetSplotAngle()メソッド、getSpotExponent()メソッドで取得できます。

\begin{verbatim}
float 	getSpotAngle () const
float 	getSpotExponent () const 
\end{verbatim}







