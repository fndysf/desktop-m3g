# ==============================
# M3G compile config file.
# ==============================


# m3g srcs
file (GLOB M3G_SRCS *.cpp)

# =====================
# m3g headers
# =====================
# Don't forget to install Configh.hpp 
# It will be automaticaly generated by CMake.
file (GLOB M3G_HEADERS *.hpp)
set  (M3G_CONFIG_HEADER ${CMAKE_CURRENT_BINARY_DIR}/m3g/Config.hpp)

# m3g target
add_library (m3g SHARED ${M3G_SRCS})

# installer
install (FILES ${M3G_HEADERS}        DESTINATION include/m3g)
install (FILES ${M3G_CONFIG_HEADER}  DESTINATION include/m3g)
install (TARGETS m3g LIBRARY DESTINATION lib)

# compile flags
set (CMAKE_CXX_FLAGS         "-Wall")
set (CMAKE_CXX_FLAGS_DEBUG   "-g")
set (CMAKE_CXX_FLAGS_RELEASE "-O2")
set (CMAKE_INCLUDE_CURRENT_DIR ON)

# dependent libraries
include_directories   (${M3G_REQUIRED_INCLUDE_DIR})
target_link_libraries (m3g ${M3G_REQUIRED_LIBRARIES})
message (STATUS "M3G_REQUIRED_LIBRARIES = ${M3G_REQUIRED_LIBRARIES}")


# precompiled libraries
set (M3G_PRECOMPILED_INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/external/include)
set (M3G_READER_WRITER_LIBRARY   ${CMAKE_CURRENT_SOURCE_DIR}/external/lib/libm3g-reader-writer.so)
set (M3G_PRECOMPILED_LIBRARIES
            -Wl,-whole-archive 
            ${M3G_READER_WRITER_LIBRARY}
            -Wl,-no-whole-archive)

include_directories (${M3G_PRECOMPILED_INCLUDE_DIR})
target_link_libraries (m3g ${M3G_PRECOMPILED_LIBRARIES})
message (STATUS "M3G_PRECOMPILED_LIBRARIES = ${M3G_PRECOMPILED_LIBRARIES}")
message (STATUS "M3G_PRECOMPILED_INCLUDE_DIR = ${M3G_PRECOMPILED_INCLUDE_DIR}")



# link m3g-reader-writer
#include_directories   (${M3G_READER_WRITER_INCLUDE_DIR})
#target_link_libraries (m3g ${M3G_READER_WRITER_LIBRARY})

# link jpeg-helper
#include_directories   (${JPEG_HELPER_INCLUDE_DIR})
#target_link_libraries (m3g ${JPEG_HELPER_LIBRARY})

# link png-helper
#include_directories   (${PNG_HELPER_INCLUDE_DIR})
#target_link_libraries (m3g ${PNG_HELPER_LIBRARY})

#message (STATUS "M3G_READER_WRITER_LINK_DIR = ${M3G_READER_WRITER_LINK_DIR}")
#message (STATUS "JPEG_HELPER_LINK_DIR = ${JPEG_HELPER_LINK_DIR}")
#message (STATUS "PNG_HELPER_LINK_DIR = ${PNG_HELPER_LINK_DIR}")


